# 001-Elo,Glicko,Trueskill
Elo,Glicko,Trueskill是三种评分算法。  
Elo算法由匈牙利裔美国物理学家Arpad Elo发明,最初用于国际象棋界，现还广泛应用于围棋足球篮球等运动，某些网络游戏也会采用该算法。  
Glicko、Glicko-2算法由Mark Glickman发明，《Lichess》和很多网络游戏都采用此算法。  
Trueskill算法由微软研究院(MSR)在2007年开发，广泛应用于Xbox Live平台。  
#

## ♟ 一、Elo
Elo 算法有两个功能：  
1. 根据双方评分,在对局开始前算出胜率  
2. 根据双方评分,在对局结束后更新分数  

---

### 📐 1. Elo胜率计算公式
我们假设每一个玩家都有一个等级分 $R$,用来衡量他的水平。  
当两名玩家 A、B 对战,Elo 系统应该准确算出双方胜率。  

我们要求这个胜率计算公式满足以下几点：  
- 二者的等级分差 $(R_a - R_b)$ 的取值范围是任意实数,也就是函数定义域是 $\mathbb{R}$  
- 胜率(函数值域)在 $(0,1)$ 区间  
- 当 $(R_a - R_b)$ 越大,A 的胜率应该越高；反之 B 的胜率越高  
- 玩家 A、B 的胜率 $E_a、E_b$ 相加等于 1  

注意到公式：  

$$
E_a = \frac{1}{1+m^{\frac{R_b - R_a}{n}}}, 
\quad 
E_b = \frac{1}{1+m^{\frac{R_a - R_b}{n}}}
$$

正好满足以上四点  

由于 Elo 被发明时(1960s),计算机没有被广泛应用于计算概率,人们大多靠手算和查对数表,所以取底数 $m=10$ 较为方便。  
因为 Elo 最初用于国际象棋界,当时的美国国际象棋协会在统计后认为,领先 400 分的国际象棋选手的胜率，应该约为 90%,所以取 $n=400$。  

此时领先 400 分的国际象棋选手的胜率为：  

$$
E = \frac{1}{1+10^{-1}} = \frac{10}{11} \approx 90.9 \\%
$$  

因此, $m=10$ , $n=400$ 经过历史的考验,被沿用至今。  

---

### 🔄 2. Elo 分数更新公式
在一次 A 和 B 的对局中,有三种结果：  
1. A 胜,B 负,记为 $S_a=1, S_b=0$  
2. 平局,记为 $S_a=S_b=0.5$  
3. A 负,记为 $S_a=0, S_b=1$  

分数更新公式：  

$$
R_a^{new} = R_a^{old} + K(S_a - E_a)
$$

$$
R_b^{new} = R_b^{old} + K(S_b - E_b)
$$  

这里的 $K$ 是学习率,用来控制分数变动程度。  
- $K$ 越大,分数波动越大  
- $K$ 越小,分数波动越小  

在给新手定位时, $K$ 可以取较大值；对于老玩家, $K$ 取较小值。  
在国际象棋大师级比赛中, $K$ 通常取 16。  

---

### ⚠️ 3. 低分Elo的处理办法
我们通常不希望Elo分值为负数，这会让人困惑，所以一般会设计一个最低分 $R_{min}>0$；  
我们也同样不希望玩家掉分过快，这样会打击菜鸟玩家的游戏积极性。  

一个常见的思路是，在某一方Elo分较低时，触发预警机制，动态调整K值，让玩家即使一直输掉对局，也不会太快到达最低分。  

考虑最坏情况：玩家 A 一直输给远比自己弱的对手,所以 $S_a=0, E_a \to 1$。  

此时分数更新公式为：  

$$
R^{new} > R - K
$$  

我们想让 $R^{new} > R_{min}$,那么只需要：  

$$
R - K \geq R_{min} \quad \Rightarrow \quad K \leq R - R_{min}
$$  

我们可以让：  

$$
K = \min(K_{max}, c(R - R_{min})), \quad c \in (0,1]
$$  

以下是一个具体的例子，我们取 $K_{max}=16$ ，$c= $ 

---

### ❌ 4. Elo的不足之处
1. 选手的真实实力是一个具体的值，而不是一个区间，无法衡量选手水平的**不确定性**  
2. 只能处理1v1的情况，不适合多人对局  

---

## 📊 二、Glicko、Glicko-2算法
Glicko算法相较于Elo算法，加入了评分误差 RD (ratings deviation)。  
如果选手很久没有参与对局，或者参与的对局很少，那么RD值就会越高，该选手当前的评分就越不可信。  
如果选手经常参与对局，且对局数很多，那么RD值就会很低，我们就可以认为他的实力很接近当前评分。  

Glicko算法要求，在一个周期内发生的对局，视作同时发生。这个周期是自定义的，可以短至一局游戏，也可以长达一个赛季。  

### 1. Glicko算法
算法过程：  

**Step1.**  
在周期开始时，对于从未参与排名的新玩家，赋予其1500的等级分 $R$，和350的评分误差 $RD$；  
对于参与过排名的玩家，他的 $R$ 继承上一周期结束后的 $R$，他的 $RD$ 通过以下公式计算：  

$$
RD_{new} = \min(\sqrt{RD_{old}^{2}+c^{2}} , 350)
$$  

该式目的是，让玩家的RD随周期的推进而自然增长，但是不会超过350。  
这里的 $c$ 可以控制两个周期之间的不确定性,关于 $c$ 的选择见后文。  

**Step2.**  
对每一名玩家分别进行如下计算：  

设一名玩家在上一周期的结算分数是 $r$ ，评分误差是 $RD$ ，  
设他的 $m$ 名对手的结算分数是 $r_1, r_2, \ldots, r_m$，他们的评分误差分别是 $RD_1, RD_2, \ldots, RD_m$。  
设该玩家和这 $m$ 名对手的对局结果分别是 $s_1, s_2, \ldots, s_m$。这里的 $s$ 取值范围是 $\\{1, 0.5, 0\\}$ ，分别代表该玩家胜、平、负。  

注意如果该玩家和某名玩家进行了 $n$ 次对弈 $(n>1)$，则被视为和 $n$ 名有相同 $r$ 和 $RD$ 的对手进行了 $n$ 次对局。  

我们记 $r’ , RD’$ 为该周期结束后的结算评分和结算评分误差。  

分数更新公式为：  

$$
r' = r+ \frac{q}{1/RD^2+1/d^2}\sum_{j=1}^m g(RD_j)(s_j-E(s|r,r_j,RD_j))
$$  

$$
RD’ = \sqrt{\left(\frac{1}{RD^2}+\frac{1}{d^2}\right)^{-1}}
$$  

其中：  

$$
q=\frac{\ln 10}{400} \approx 0.0057565
$$  

$$
g(RD)=\frac{1}{\sqrt{1+\frac{3q^2 RD^2}{\pi^2}}}
$$  

$$
E(s|r,r_j,RD_j)=\frac{1}{1+10^{-g(RD_j)(r-r_j)/400}}
$$  

$$
d^2 = \Bigg(q^2 \sum_{j=1}^m (g(RD_j))^2 E(s|r,r_j,RD_j) (1-E(s|r,r_j,RD_j))\Bigg)^{-1}
$$  

胜率计算公式为：  

$$
E=\frac{1}{1+10^{-g(\sqrt{RD_i^2+RD_j^2})(r_i-r_j)/400}}
$$  

---

### 📏 选手得分的置信区间
根据贝叶斯推断，我们有95%的把握认为选手的真实实力评分应该在以下区间：  

$$
(r-1.96RD, \; r+1.96RD)
$$  

---

### ⚙️ 2. c的选择
*(原文保留，未展开)*  

---

### 💡 3. Glickman的建议
Glickman认为，Glicko算法有一个问题，如果一个玩家频繁进行比赛，他的评分很难有实质性的变化，所以Glickman建议将30设置为RD的最低值。  



---

### 📚 参考文献
- [Glicko论文原文](https://www.glicko.net/glicko/glicko.pdf)  
- [Trueskill论文原文](https://www.microsoft.com/en-us/research/wp-content/uploads/2007/01/NIPS2006_0688.pdf)  
- [Trueskill2论文原文](https://www.microsoft.com/en-us/research/wp-content/uploads/2018/03/trueskill2.pdf?msockid=2cece72ed59b633523c6f13fd4d862ef)  

